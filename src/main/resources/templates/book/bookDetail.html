<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout1}">
<head>
  <title>도서 상세 정보</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #f3f4f6;
      font-family: 'Roboto', sans-serif;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: 30px auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .book-info {
      text-align: right;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .book-thumbnail {
      object-fit: cover;
      width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .book-title {
      font-size: 2em;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 15px;
    }
    .book-meta {
      font-size: 0.9em;
      color: #4a5568;
      margin: 5px 0;
    }
    .isbn-info {
      font-size: 0.8em;
      color: #718096;
      margin-top: 10px;
    }
    .book-price {
      margin-top: 10px;
      font-size: 1em;
      font-weight: 600;
    }
    .book-price .original-price {
      color: #a0aec0;
      text-decoration: line-through;
      font-size: 0.9em;
    }
    .book-price .discount-rate {
      color: #16a085;
      font-weight: bold;
      font-size: 1em;
      padding: 2px 5px;
      background-color: #d1f2eb;
      border-radius: 4px;
      margin-left: 5px;
    }
    .book-price .sale-price {
      color: #e53e3e;
      font-weight: 700;
      font-size: 1.5em;
      margin-left: 20px;
    }
    .book-description, .book-contents {
      margin-top: 30px;
      line-height: 1.8;
      color: #2d3748;
    }
    .book-section-title {
      font-size: 1.5em;
      font-weight: 700;
      margin-bottom: 15px;
      color: #1a202c;
      border-bottom: 2px solid #2d3748;
      padding-bottom: 8px;
    }
    .btn-custom {
      padding: 8px 20px;
      font-size: 0.9em;
      font-weight: 600;
      border-radius: 20px;
      margin-left: 10px; /* 버튼 간 간격 */
      transition: all 0.3s ease;
    }
    .btn-primary {
      background-color: #3182ce;
      color: #fff;
      border: none;
    }
    .btn-primary:hover {
      background-color: #2b6cb0;
    }
    .btn-secondary {
      background-color: #e53e3e;
      color: #fff;
      border: none;
    }
    .btn-secondary:hover {
      background-color: #c53030;
    }
    .button-group {
      display: flex;
      justify-content: flex-end;
      margin-top: 15px;
    }
    .like-button {
      display: flex;
      align-items: center;
      font-size: 1em;
      color: #e53e3e;
      cursor: pointer;
      font-weight: 600;
      margin-left: auto;
    }
    .like-button i {
      font-size: 1.2em;
      margin-right: 5px;
    }
    .like-count {
      font-size: 1em;
      font-weight: bold;
      color: #2d3748;
      margin-right: 5px;
    }
  </style>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
<div layout:fragment="content">
  <div class="container">
    <div class="row justify-content-between">
      <!-- Book Thumbnail -->
      <div class="col-md-4 text-center">
        <img th:src="${book.thumbnailImageUrl}" alt="도서 이미지" class="book-thumbnail">
      </div>

      <!-- Book Information -->
      <div class="col-md-8 book-info">
        <h1 class="book-title" th:text="${book.title}">도서 제목</h1>
        <!-- Contributors Information -->
        <div class="contributors mt-3">
          <th:block th:each="entry : ${book.contributorsByRole}">
            <!-- 작가 이름들을 콤마로 구분하여 나열 -->
            <span th:each="name, iterStat : ${entry.value}" th:text="${name + (iterStat.last ? '' : ', ')}">작가 이름</span>
            <!-- 역할 표시 -->
            <span th:text="' : ' + ${entry.key}"> : 역할</span><br/>
          </th:block>
        </div>
        <p class="book-meta"><strong>출판사:</strong> <span th:text="${book.publisherName}" class="text-emphasis">출판사 정보</span></p>
        <p class="book-meta"><strong>출판일:</strong> <span th:text="${#temporals.format(book.publicationDate, 'yyyy-MM-dd')}" class="text-emphasis">출판일</span></p>
        <p class="book-meta"><strong>상태:</strong> <span th:text="${book.state}" class="text-emphasis">상태 정보</span></p>

        <div class="book-price">
          <span class="original-price" th:text="'정가: ' + ${book.price} + ' 원'">정가</span>
          <span class="discount-rate" th:if="${book.discountRate > 0}" th:text="'할인율: ' + ${book.discountRate} + ' %'">할인율</span><br/>
          <span class="sale-price" th:text="'판매가: ' + ${book.salePrice} + ' 원'">판매가</span>
        </div>

        <p class="isbn-info" th:if="${book.isbn} != null">
          <strong>ISBN:</strong> <span th:text="${book.isbn}">ISBN 정보</span>
        </p>

        <div class="book-meta mt-3" th:if="${book.tagNames?.size() > 0}">
          <strong>태그:</strong>
          <span th:each="tag : ${book.tagNames}" th:text="${tag}" class="badge badge-secondary mr-1">태그</span>
        </div>

        <!-- Buttons aligned to the right in one line -->
        <div class="button-group mt-3">
          <a href="#" class="btn btn-secondary btn-custom">바로 구매하기</a>

          <form th:action="@{/api/cart}" method="post">
            <!-- 수량 입력 필드 -->
            <label for="quantity">수량:</label>
            <input type="number" id="quantity" name="quantity" value="1" min="1" required>
            <input type="hidden" name="bookId" th:value="${book.id}">
            <button type="submit" class="btn btn-secondary btn-custom">장바구니에 담기</button>
          </form>
        </div>

        <!-- Like button aligned to the right -->
        <div class="like-button mt-3" onclick="toggleLike()">
          <i class="fas fa-heart"></i>
          <span th:text="${book.likeCount}" class="like-count">0</span>
        </div>
      </div>
    </div>

    <!-- Book Description -->
    <div class="book-description mt-5">
      <h2 class="book-section-title">책 소개</h2>
      <div class="book-meta mt-3" th:if="${book.simpleCategories?.size() > 0}">
        <strong>카테고리:</strong>
        <div th:each="breadcrumb : ${book.simpleCategories}">
    <span>
      <span th:each="category, iterStat : ${breadcrumb}">
        <a th:href="@{/view/books/categories/{categoryId}(categoryId=${category.id})}"
           th:text="${category.name}"></a>
        <span th:if="${!iterStat.last}"> > </span>
      </span>
    </span><br/>
        </div>
      </div>dd
      <p th:text="${book.description}">책 소개 내용</p>
    </div>

    <!-- Book Contents -->
    <div class="book-contents mt-5">
      <h2 class="book-section-title">목차</h2>
      <p th:text="${book.contents}">목차 내용</p>
    </div>
    <div class="mt-5">
      <h2 class="book-section-title">리뷰</h2>

      <div th:replace="book/review/list::reviews"></div>

    </div>
  </div>
    <div th:replace="fragments/page::page(url=${'/view/book/details/'+ book.id})"></div>

</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function toggleLike() {
    const likeButton = document.querySelector('.like-button .fa-heart');
    const likeCountElement = document.querySelector('.like-count');
    let likeCount = parseInt(likeCountElement.textContent);

    if (likeButton.classList.contains('liked')) {
      likeButton.classList.remove('liked');
      likeCountElement.textContent = likeCount - 1;
    } else {
      likeButton.classList.add('liked');
      likeCountElement.textContent = likeCount + 1;
    }
  }
</script>
</body>

</html>
