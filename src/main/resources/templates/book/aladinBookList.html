<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Aladin 도서 목록</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
</head>
<body class="container py-4 bg-light rounded shadow">
<div class="text-center mb-4">
  <h1 class="text-uppercase">Aladin 도서 목록</h1>
</div>
<div class="text-center mb-3">
  <a href="/api/view/aladin/books/list" class="btn btn-primary">도서 목록 조회</a>
</div>

<div class="my-4">
  <ul class="list-group" th:if="${books != null}" th:each="book : ${books}">
    <li class="list-group-item d-flex justify-content-between align-items-start">
      <div>
        <strong th:text="${book.title}">제목</strong><br>
        <small th:text="'저자: ' + ${book.author}">저자</small><br>
        <small th:text="'출판일: ' + ${book.pubDate}">출판일</small>
      </div>
      <button class="btn btn-sm btn-secondary" onclick="showEditForm('[[${book.isbn}]]')">선택</button>
    </li>
  </ul>
  <p th:if="${books == null || books.isEmpty()}" class="text-center text-muted mt-4">도서 목록이 없습니다.</p>
</div>

<!-- 도서 편집 폼 -->
<div id="editForm" style="display: none;" class="mt-4">
  <h3 class="text-center">도서 선택 및 편집</h3>
  <form th:action="@{/api/books/aladin/save}" method="post" id="editBookForm">
    <input type="hidden" name="isbn" id="isbn">
    <div class="mb-3">
      <label for="title" class="form-label">제목</label>
      <input type="text" class="form-control" id="title" name="title" required>
    </div>
    <div class="mb-3">
      <label for="author" class="form-label">저자</label>
      <input type="text" class="form-control" id="author" name="author" required>
    </div>
    <div class="mb-3">
      <label for="pubDate" class="form-label">출판일</label>
      <input type="text" class="form-control" id="pubDate" name="pubDate" required>
    </div>
    <!-- 필요한 다른 필드들 추가 -->
    <button type="submit" class="btn btn-success w-100">등록</button>
  </form>
</div>

<script>
  function showEditForm(isbn) {
    // AJAX 요청을 통해 선택된 도서 정보를 가져옵니다.
    fetch(`/api/view/aladin/books/${isbn}`)
            .then(response => response.json())
            .then(data => {
              document.getElementById('editForm').style.display = 'block';
              document.getElementById('isbn').value = data.isbn;
              document.getElementById('title').value = data.title;
              document.getElementById('author').value = data.author;
              document.getElementById('pubDate').value = data.pubDate;
              // 다른 필드들도 값 설정
            })
            .catch(error => console.error('도서 정보를 가져오는 중 오류 발생:', error));
  }
</script>
</body>
</html>
