<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layout/adminlayout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/floating-label.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>회원 관리</title>
    <style>
        /* 전체 화면을 차지하도록 설정 */
        body, html {
            height: 100%;
            margin: 0;
        }
        .container {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* 상단 정렬 */
        }
        .card {
            margin-bottom: 20px; /* 카드와 테이블 사이의 여백 */
        }
        .table-container {
            width: 100%; /* 테이블이 전체 너비를 차지하도록 설정 */
            overflow-x: auto; /* 가로 스크롤 */
        }
        .table {
            width: 100%; /* 테이블을 전체 너비로 설정 */
        }
        .table th, .table td {
            text-align: center; /* 제목과 데이터 모두 가운데 정렬 */
            vertical-align: middle; /* 데이터도 세로 가운데 정렬 */
            white-space: nowrap; /* 텍스트가 줄 바꿈되지 않도록 설정 */
        }
    </style>
</head>
<body>
<div layout:fragment="content">
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-12 col-md-12 col-sm-12"> <!-- 전체 너비를 차지하도록 수정 -->
            <div class="card shadow">
                <div class="card-header text-center">
                    <h3>회원 정보 검색</h3>
                </div>
                <div class="card-body">
                    <form th:action="@{/admin/member/members}" method="get" id="search_form">
                        <div class="form-group">
                            <input type="text" class="form-control" id="name" name="name" placeholder=" "
                                   th:value="${request != null ? request.name : ''}">
                            <label for="name" class="floating-label">이름</label>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="username" name="username" placeholder=" "
                                   th:value="${request != null ? request.username : ''}">
                            <label for="name" class="floating-label">아이디</label>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="email" name="email" placeholder=" "
                                   th:value="${request != null ? request.email : ''}">
                            <label for="email" class="floating-label">이메일</label>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" placeholder=" "
                                   th:value="${request != null ? request.phoneNumber : ''}">
                            <label for="phoneNumber" class="floating-label">전화번호</label>
                        </div>
                        <div class="form-group">
                            <label for="gender">성별</label>
                            <select class="form-control" id="gender" name="gender">
                                <option value="" disabled selected hidden>성별을 선택하세요</option>
                                <option value="MALE" th:selected="${request != null && request.gender == 'MALE'}">남성</option>
                                <option value="FEMALE" th:selected="${request != null && request.gender == 'FEMALE'}">여성</option>
                                <option value="OTHER" th:selected="${request != null && request.gender == 'OTHER'}">기타</option>
                                <option value="NULL" th:selected="${request != null && request.gender == 'NULL'}">선택하지 않음</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gender">등급</label>
                            <select class="form-control" id="gradeName" name="gradeName">
                                <option value="" disabled selected hidden>등급을 선택하세요</option>
                                <option value="STANDARD" th:selected="${request != null && request.gradeName == 'STANDARD'}">STANDARD</option>
                                <option value="SILVER" th:selected="${request != null && request.gradeName == 'SILVER'}">SILVER</option>
                                <option value="GOLD" th:selected="${request != null && request.gradeName == 'GOLD'}">GOLD</option>
                                <option value="PLATINUM" th:selected="${request != null && request.gradeName == 'PLATINUM'}">PLATINUM</option>
                                <option value="ROYAL" th:selected="${request != null && request.gradeName == 'ROYAL'}">ROYAL</option>
                                <option value="NULL" th:selected="${request != null && request.gradeName == 'NULL'}">선택하지 않음</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">상태</label>
                            <select class="form-control" id="status" name="status">
                                <option value="" disabled selected hidden>상태를 선택하세요</option>
                                <option value="ACTIVE" th:selected="${request != null && request.status == 'ACTIVE'}">활동</option>
                                <option value="INACTIVE" th:selected="${request != null && request.status == 'INACTIVE'}">휴면</option>
                                <option value="WITHDRAWN" th:selected="${request != null && request.status == 'WITHDRAWN'}">탈퇴</option>
                                <option value="NULL" th:selected="${request != null && request.status == 'NULL'}">선택하지 않음</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">권한</label>
                            <select class="form-control" id="authority" name="authority">
                                <option value="" disabled selected hidden>권한을 선택하세요</option>
                                <option value="MEMBER" th:selected="${request != null && request.authority == 'MEMBER'}">일반회원</option>
                                <option value="SELLER" th:selected="${request != null && request.authority == 'SELLER'}">판매자</option>
                                <option value="ADMIN" th:selected="${request != null && request.authority == 'ADMIN'}">관리자</option>
                                <option value="NULL" th:selected="${request != null && request.authority == 'NULL'}">선택하지 않음</option>
                            </select>
                        </div>
                        <!-- '결과 목록' 선택 드롭다운 -->
                        <div class="form-group">
                            <label for="size">결과 목록</label>
                            <select class="form-control" id="size" name="size">
                                <option value="20" th:selected="${request != null && request.size == 20}">20명씩 보기</option>
                                <option value="50" th:selected="${request != null && request.size == 50}">50명씩 보기</option>
                                <option value="100" th:selected="${request != null && request.size == 100}">100명씩 보기</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">검색</button>
                    </form>
                </div>
            </div>

        </div> <!-- col-lg-12 col-md-12 col-sm-12 (End) -->

        <!-- members가 존재할 때만 테이블 보이기 -->
        <div th:if="${not #lists.isEmpty(members)}" class="table-container">
            <table class="table table-striped table-bordered table-hover mt-4">
                <thead class="thead-dark">
                <tr>
                    <th>고객 ID</th>
                    <th>이름</th>
                    <th>성별</th>
                    <th>전화번호</th>
                    <th>이메일</th>
                    <th>생일</th>
                    <th>사용자 ID</th>
                    <th>포인트</th>
                    <th>총 결제 금액</th>
                    <th>권한</th>
                    <th>등급</th>
                    <th>상태</th>
                    <th>가입일</th>
                    <th>최종 로그인 일시</th>
                </tr>
                </thead>
                <tbody>
                <!-- 각 회원 데이터를 테이블에 출력 -->
                <tr th:each="member : ${members}">
                    <td th:text="${member.customerId}"></td>
                    <td th:text="${member.name}"></td>
                    <td th:text="${member.gender}"></td>
                    <td th:text="${member.phoneNumber}"></td>
                    <td th:text="${member.email}"></td>
                    <td th:text="${member.birthday}"></td>
                    <td th:text="${member.username}"></td>
                    <td th:text="${#numbers.formatInteger(member.point, 1, 'COMMA') + '원'}"></td>
                    <td th:text="${#numbers.formatInteger(member.totalPaymentAmount, 1, 'COMMA') + '원'}"></td>
                    <td th:text="${member.authority}"></td>
                    <td th:text="${member.gradeName}"></td>
                    <td th:text="${member.status}"></td>
                    <td th:text="${member.createdAt}"></td>
                    <td th:text="${member.latestLoginAt}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- members가 없을 때 메시지 -->
        <div th:if="${#lists.isEmpty(members)}">
            <p class="text-center text-muted">검색된 회원이 없습니다.</p>
        </div>

    </div> <!-- row justify-content-center (End) -->
</div> <!-- container (End) -->

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</div>
</body>
</html>
