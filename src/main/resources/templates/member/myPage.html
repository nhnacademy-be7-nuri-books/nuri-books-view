<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout1}">
<head>
    <title>마이 페이지</title>
    <!-- 필요한 CSS 파일 (예: 부트스트랩, FontAwesome 등) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
<!-- Main Content -->
<div layout:fragment="content">
    <div class="container-fluid">
        <div class="row">
            <!-- 사이드바 -->
            <div class="col-lg-3 col-md-4 col-sm-12">
                <nav class="sidebar bg-dark text-white" style="min-height: 100vh; position: sticky; top: 0;">
                    <ul class="nav flex-column px-3">
                        <!-- 회원 정보 조회 -->
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-white sidebar-item" data-url="/mypage">
                                <i class="fas fa-user-circle me-2"></i>회원 정보 조회
                            </a>
                        </li>

                        <!-- 회원 정보 수정 -->
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-white sidebar-item" data-url="/mypage/edit">
                                <i class="fas fa-user-edit me-2"></i>회원 정보 수정
                            </a>
                        </li>

                        <hr class="sidebar-divider">

                        <!-- 구매 내역 -->
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-white sidebar-item" data-url="/mypage/orders">
                                <i class="fas fa-boxes me-2"></i>구매 내역
                            </a>
                        </li>

                        <hr class="sidebar-divider">

                        <!-- 로그아웃 -->
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-white sidebar-item" data-url="/logout">
                                <i class="fas fa-sign-out-alt me-2"></i>로그아웃
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- 마이 페이지 본문 -->
            <div class="col-lg-9 col-md-8 col-sm-12">
                <div class="row">
                    <div class="col-12 mt-3 text-center text-uppercase">
                        <h2>마이 페이지</h2>
                    </div>
                </div>

                <main class="row">
                    <div class="col-lg-8 col-md-10 col-sm-12 mx-auto bg-light rounded shadow py-4 mb-4">
                        <div class="text-center mb-4">
                            <p>회원님의 정보를 확인하고 수정하세요.</p>
                        </div>
                        <form class="row" th:action="@{/myPage}" method="post" id="my_page_form">
                            <div class="col-md-12 form-group mb-3">
                                <label for="userId">아이디</label>
                                <input type="text" class="form-control" id="userId" name="userId"
                                       th:value="${userRequest?.userId ?: ''}" placeholder="회원 아이디" readonly>
                            </div>
                            <div class="col-md-12 form-group mb-3">
                                <label for="name">이름</label>
                                <input type="text" class="form-control" id="name" name="name"
                                       th:value="${userRequest?.name ?: ''}" placeholder="이름" required>
                                <small class="form-text text-muted">사용자 이름은 2자 이상 30자 이하로 입력해야 합니다.</small>
                            </div>
                            <div class="col-md-12 form-group mb-3">
                                <label for="password">새 비밀번호</label>
                                <input type="password" class="form-control" id="password" name="password"
                                       placeholder="새 비밀번호" required>
                                <small class="form-text text-muted">사용자 비밀번호는 8자 이상 20자 이하로 입력해야 합니다.</small>
                            </div>
                            <div class="col-md-12 form-group mb-3">
                                <label for="confirmPassword">새 비밀번호 확인</label>
                                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                                       placeholder="새 비밀번호 확인" required>
                            </div>
                            <div id="passwordError" class="text-danger" style="display:none;">
                                비밀번호가 일치하지 않습니다.
                            </div>
                            <div class="col-md-12 form-group mb-3">
                                <label for="phoneNumber">전화번호</label>
                                <input type="text" class="form-control" id="phoneNumber" name="phoneNumber"
                                       th:value="${userRequest?.phoneNumber ?: ''}" placeholder="전화번호" required>
                                <small class="form-text text-muted">전화번호는 10자 이상 13자 이하의 숫자로 입력해야 합니다.</small>
                            </div>
                            <div id="phoneError" class="text-danger" style="display:none;">
                                전화번호는 10자 이상 13자 이하의 숫자로 입력해야 합니다.
                            </div>
                            <div class="col-md-12 form-group mb-3">
                                <button type="submit" class="btn btn-primary w-100">정보 수정</button>
                            </div>
                        </form>
                        <div id="alertMessage" class="alert alert-danger" style="display:none;"></div> <!-- 오류 메시지 표시 영역 -->
                    </div>
                </main>
            </div>
        </div>
    </div>
</div>
<!-- Main Content -->

<!-- Script -->
<th:block layout:fragment="script">
    <script>
        document.getElementById('my_page_form').onsubmit = function(event) {
            var username = document.getElementById('name').value;
            var password = document.getElementById('password').value;
            var confirmPassword = document.getElementById('confirmPassword').value;
            var phoneNumber = document.getElementById('phoneNumber').value;
            var errorPasswordDiv = document.getElementById('passwordError');
            var errorPhoneDiv = document.getElementById('phoneError');
            var alertMessage = document.getElementById('alertMessage');
            alertMessage.style.display = 'none'; // 초기화

            // 사용자 이름 유효성 검사
            if (username.length < 2 || username.length > 30) {
                alertMessage.textContent = "이름은 2자 이상 30자 이하로 입력해야 합니다."; // 사용자 이름 오류 메시지
                alertMessage.style.display = 'block'; // 오류 메시지 표시
                return false; // 폼 제출 중지
            }

            // 비밀번호 유효성 검사
            if (password.length < 8 || password.length > 20) {
                alertMessage.textContent = "사용자 비밀번호는 8자 이상 20자 이하로 입력해야 합니다."; // 비밀번호 오류 메시지
                alertMessage.style.display = 'block'; // 오류 메시지 표시
                return false; // 폼 제출 중지
            }

            // 비밀번호 확인
            if (password !== confirmPassword) {
                errorPasswordDiv.style.display = 'block'; // 오류 메시지 표시
                return false; // 폼 제출 중지
            } else {
                errorPasswordDiv.style.display = 'none'; // 오류 메시지 숨김
            }

            // 전화번호 유효성 검사
            var phoneRegex = /^[0-9]{10,13}$/; // 10자에서 13자 사이의 숫자만 허용
            if (!phoneRegex.test(phoneNumber)) {
                errorPhoneDiv.style.display = 'block'; // 오류 메시지 표시
                return false; // 폼 제출 중지
            } else {
                errorPhoneDiv.style.display = 'none'; // 오류 메시지 숨김
            }

            // 유효성 검사에 통과하면 폼이 제출됨
        };
    </script>
</th:block>
<!-- Script -->

<!-- Bootstrap JS, Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
